<div class="eqLogic eqLogic-widget text-center allowResize allowReorderCmd #custom_layout# #eqLogic_class# #class# #category#" data-eqType="#eqType#" data-eqLogic_id="#id#" data-eqLogic_uid="#uid#" data-version="#version#" data-translate-category="#translate_category#" data-category="#category#" data-tags="#tags#" style="width: #width#;height: #height#;#style#">
  <div class="widget-name">
    <span style="color:#background-color#" title="#alert_name#">
      <i class='#alert_icon#'></i>
    </span>
    <span class="cmd refresh pull-right cursor" data-cmd_id="#refresh_id#">
      <i class="fas fa-sync"></i>
    </span>
    <span class="panelLink pull-left cursor">
      <a href="#panelLink#"><i class="fas fa-external-link-alt"></i></a>
    </span>
    <span class="reportModeVisible">#name_display# <span class="object_name">#object_name#</span></span>
    <a href="#eqLink#" class="reportModeHidden">#name_display# <span class="object_name">#object_name#</span></a>
  </div>
  <div class="cmds #isVerticalAlign#">
    <div class="cmd cmd-widget reportModeHidden #cmd_courseFL24inchBaseTitan_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_courseFL24inchBaseTitan_id#">
      <div class="title #cmd_courseFL24inchBaseTitan_nameDisplay#">
        <div class="cmdName">#cmd_courseFL24inchBaseTitan_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd course" data-logicalId="courseFL24inchBaseTitan">#cmd_courseFL24inchBaseTitan_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_smartCourseFL24inchBaseTitan_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_smartCourseFL24inchBaseTitan_id#">
      <div class="title #cmd_smartCourseFL24inchBaseTitan_nameDisplay#">
        <div class="cmdName">#cmd_smartCourseFL24inchBaseTitan_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd course" data-logicalId="smartCourseFL24inchBaseTitan">#cmd_smartCourseFL24inchBaseTitan_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_spin_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_spin_id#">
      <div class="title #cmd_spin_nameDisplay#">
        <div class="cmdName">#cmd_spin_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="spin">#cmd_spin_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_rinse_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_rinse_id#">
      <div class="title #cmd_rinse_nameDisplay#">
        <div class="cmdName">#cmd_rinse_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="rinse">#cmd_rinse_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_dryLevel_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_dryLevel_id#">
      <div class="title #cmd_dryLevel_nameDisplay#">
        <div class="cmdName">#cmd_dryLevel_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="dryLevel">#cmd_dryLevel_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_temp_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_temp_id#">
      <div class="title #cmd_temp_nameDisplay#">
        <div class="cmdName">#cmd_temp_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="temp">#cmd_temp_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_soilWash_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_soilWash_id#">
      <div class="title #cmd_soilWash_nameDisplay#">
        <div class="cmdName">#cmd_soilWash_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="soilWash">#cmd_soilWash_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_loadItemWasher_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_loadItemWasher_id#">
      <div class="title #cmd_loadItemWasher_nameDisplay#">
        <div class="cmdName">#cmd_loadItemWasher_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="loadItemWasher">#cmd_loadItemWasher_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_reserveTimeHour_display#" data-type="action" data-subtype="message" data-template="default" data-cmd_id="#cmd_reserveTimeHour_id#">
      <div class="title #cmd_reserveTimeHour_nameDisplay#">
        <div class="cmdName">#cmd_reserveTimeHour_name#</div>
      </div>
      <div class="content-xs">
        <input type="number" class="inputCmd options" data-logicalId="reserveTimeHour" min="#cmd_reserveTimeHour_min#" max="#cmd_reserveTimeHour_max#" value="#cmd_reserveTimeHour_value#">
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_reserveTimeMinute_display#" data-type="action" data-subtype="message" data-template="default" data-cmd_id="#cmd_reserveTimeMinute_id#">
      <div class="title #cmd_reserveTimeMinute_nameDisplay#">
        <div class="cmdName">#cmd_reserveTimeMinute_name#</div>
      </div>
      <div class="content-xs">
        <input type="number" class="inputCmd options" data-logicalId="reserveTimeMinute" min="#cmd_reserveTimeMinute_min#" max="#cmd_reserveTimeMinute_max#" value="#cmd_reserveTimeMinute_value#">
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_initialBit_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_initialBit_id#">
      <div class="title #cmd_initialBit_nameDisplay#">
        <div class="cmdName">#cmd_initialBit_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="initialBit">#cmd_initialBit_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_preWash_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_preWash_id#">
      <div class="title #cmd_preWash_nameDisplay#">
        <div class="cmdName">#cmd_preWash_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="preWash">#cmd_preWash_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_creaseCare_display" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_creaseCare_id#">
      <div class="title #cmd_creaseCare_nameDisplay#">
        <div class="cmdName">#cmd_creaseCare_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="creaseCare">#cmd_creaseCare_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_ecoHybrid_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_ecoHybrid_id#">
      <div class="title #cmd_ecoHybrid_nameDisplay#">
        <div class="cmdName">#cmd_ecoHybrid_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="ecoHybrid">#cmd_ecoHybrid_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_wrinkleCare_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_wrinkleCare_id#">
      <div class="title #cmd_wrinkleCare_nameDisplay#">
        <div class="cmdName">#cmd_wrinkleCare_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="wrinkleCare">#cmd_wrinkleCare_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_turboWash_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_turboWash_id#">
      <div class="title #cmd_turboWash_nameDisplay#">
        <div class="cmdName">#cmd_turboWash_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="turboWash">#cmd_turboWash_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_rinseSpin_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_rinseSpin_id#">
      <div class="title #cmd_rinseSpin_nameDisplay#">
        <div class="cmdName">#cmd_rinseSpin_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="rinseSpin">#cmd_rinseSpin_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_steam_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_steam_id#">
      <div class="title #cmd_steam_nameDisplay#">
        <div class="cmdName">#cmd_steam_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="steam">#cmd_steam_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_steamSoftener_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_steamSoftener_id#">
      <div class="title #cmd_steamSoftener_nameDisplay#">
        <div class="cmdName">#cmd_steamSoftener_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="steamSoftener">#cmd_steamSoftener_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_childLock_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_childLock_id#">
      <div class="title #cmd_childLock_nameDisplay#">
        <div class="cmdName">#cmd_childLock_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="childLock">#cmd_childLock_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_medicRinse_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_medicRinse_id#">
      <div class="title #cmd_medicRinse_nameDisplay#">
        <div class="cmdName">#cmd_medicRinse_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="medicRinse">#cmd_medicRinse_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_remoteStart_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_remoteStart_id#">
      <div class="title #cmd_remoteStart_nameDisplay#">
        <div class="cmdName">#cmd_remoteStart_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="remoteStart">#cmd_remoteStart_valueMapping#</select>
      </div>
    </div>

    <div class="cmd cmd-widget reportModeHidden #cmd_doorLock_display#" data-type="action" data-subtype="select" data-template="default" data-cmd_id="#cmd_doorLock_id#">
      <div class="title #cmd_doorLock_nameDisplay#">
        <div class="cmdName">#cmd_doorLock_name#</div>
      </div>
      <div class="content-xs">
        <select class="selectCmd options" data-logicalId="doorLock">#cmd_doorLock_valueMapping#</select>
      </div>
    </div>
    #cmd#

    <div class="content">
      <a class="btn btn-sm btn-default execute tooltips" data-logicalid="#cmdAction_WMDownload_logicalid#" data-cmd_id="#cmdAction_WMDownload_id#">#cmdAction_WMDownload_name#</a>
      <a class="btn btn-sm btn-default execute tooltips" data-logicalid="#cmdAction_WMStart_logicalid#" data-cmd_id="#cmdAction_WMStart_id#">#cmdAction_WMStart_name#</a>
      <a class="btn btn-sm btn-default execute tooltips" data-logicalid="#cmdAction_WMStop_logicalid#" data-cmd_id="#cmdAction_WMStop_id#">#cmdAction_WMStop_name#</a>
      <a class="btn btn-sm btn-default execute tooltips" data-logicalid="#cmdAction_WMOff_logicalid#" data-cmd_id="#cmdAction_WMOff_id#">#cmdAction_WMOff_name#</a>
      <a class="btn btn-sm btn-default execute tooltips" data-logicalid="#cmdAction_WMWakeup_logicalid#" data-cmd_id="#cmdAction_WMWakeup_id#">#cmdAction_WMWakeup_name#</a>
    </div>
  </div>
  #divGraphInfo#
    <template></template>
    <script>
      var span = '';
      var smartCourseRef#id# = JSON.parse('#cmd_smartCourseFL24inchBaseTitan_refInfo#');
      var courseRef#id# = JSON.parse('#cmd_courseFL24inchBaseTitan_refInfo#');

      if ('#cmd_courseFL24inchBaseTitan_id#' != '#' + 'cmd_courseFL24inchBaseTitan_id#') {
          document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .cmd[data-cmd_id="#cmd_courseFL24inchBaseTitan_id#"] .selectCmd')?.addEventListener('change', function() {
              var courseValue = this.value;
              if (courseRef#id#[courseValue]) {
                  for (var key in courseRef#id#[courseValue]['default']) {
                      if (document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd[data-logicalId="'+key+'"]')) {
                          var cmdKey = document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd[data-logicalId="'+key+'"]');
                          if (cmdKey.querySelector('option[value="'+courseRef#id#[courseValue]['default'][key]+'"]')) {
                              var cmdSelected = cmdKey.querySelector('option[value="'+courseRef#id#[courseValue]['default'][key]+'"]');
                              cmdSelected.selected = true;
                              cmdKey.setAttribute('style', 'color:var(--logo-primary-color) !important');
                          } else if (cmdKey.querySelector('input.binarySwitch')){
                              cmdKey.querySelector('input.binarySwitch').checked = true;
                              cmdKey.setAttribute('style', 'color:var(--logo-primary-color) !important');
                          }
                      } else if (document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .inputCmd[data-logicalId="'+key+'"]')) {
                          var cmdKey = document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .inputCmd[data-logicalId="'+key+'"]');
                          cmdKey.value = courseRef#id#[courseValue]['default'][key];
                          cmdKey.setAttribute('style', 'color:var(--logo-primary-color) !important');
                      }
                  }
                  // unset color for changed values
                  setTimeout(function() {
                      for (var key in courseRef#id#[courseValue]['default']) {
                          if (document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd[data-logicalId="'+key+'"]')) {
                              document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd[data-logicalId="'+key+'"]').setAttribute('style', 'color:unset !important');
                          } else if (document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .inputCmd[data-logicalId="'+key+'"]')) {
                              document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .inputCmd[data-logicalId="'+key+'"]').setAttribute('style', 'color:var(--link-color) !important');
                          }
                      }
                  }, 1500);
              }
          })
      }

      if ('#cmd_smartCourseFL24inchBaseTitan_id#' != '#' + 'cmd_smartCourseFL24inchBaseTitan_id#') {
          document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .cmd[data-cmd_id="#cmd_smartCourseFL24inchBaseTitan_id#"] .selectCmd')?.addEventListener('change', function() {
              var courseValue = this.value;
              if (smartCourseRef#id#[courseValue]) {
                  for (var key in smartCourseRef#id#[courseValue]['default']) {
                      if (document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd[data-logicalId="'+key+'"]')) {
                          var cmdKey = document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd[data-logicalId="'+key+'"]');
                          if (cmdKey.querySelector('option[value="'+smartCourseRef#id#[courseValue]['default'][key]+'"]')) {
                              var cmdSelected = cmdKey.querySelector('option[value="'+smartCourseRef#id#[courseValue]['default'][key]+'"]');
                              cmdSelected.selected = true;
                              cmdKey.setAttribute('style', 'color:var(--logo-primary-color) !important');
                          } else if (cmdKey.querySelector('input.binarySwitch')){
                              cmdKey.querySelector('input.binarySwitch').checked = true;
                              console.log(smartCourseRef#id#[courseValue]['default'][key])
                              cmdKey.querySelector('input.binarySwitch').value = smartCourseRef#id#[courseValue]['default'][key];
                              cmdKey.setAttribute('style', 'color:var(--logo-primary-color) !important');
                          }
                      } else if (document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .inputCmd[data-logicalId="'+key+'"]')) {
                          var cmdKey = document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .inputCmd[data-logicalId="'+key+'"]');
                          cmdKey.value = smartCourseRef#id#[courseValue]['default'][key];
                          cmdKey.setAttribute('style', 'color:var(--logo-primary-color) !important');
                      }
                  }
                  // unset color for changed values
                  setTimeout(function() {
                      for (var key in smartCourseRef#id#[courseValue]['default']) {
                          if (document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd[data-logicalId="'+key+'"]')) {
                              document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd[data-logicalId="'+key+'"]').setAttribute('style', 'color:var(--link-color) !important');
                          } else if (document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .inputCmd[data-logicalId="'+key+'"]')) {
                              document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .inputCmd[data-logicalId="'+key+'"]').setAttribute('style', 'color:var(--link-color) !important');
                          }
                      }
                  }, 1500);
              }
          })
      }

      if ('#panelLink#' == '') {
          document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .panelLink')?.remove()
      }
      if ('#refresh_id#' != '') {
          document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .refresh')?.addEventListener('click', function() {
              jeedom.cmd.execute({ id: '#refresh_id#' })
          })
      } else {
          document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"] .refresh')?.remove()
      }

      document.querySelectorAll('.eqLogic[data-eqLogic_uid="#uid#"] .cmds .cmd').forEach(_cmd => {
          var attrId = _cmd.getAttribute('data-cmd_id')
          if (isNaN(attrId) && /^#.*#$/.test(attrId)) {
              var sett = _cmd.querySelector('.inputCmd,.selectCmd').getAttribute('data-logicalId');
              var found = Object.keys(courseRef#id#).some(function(key) {
                  return courseRef#id#[key].default[sett];
              });
              var found2 = Object.keys(smartCourseRef#id#).some(function(key) {
                  return smartCourseRef#id#[key].default[sett];
              });
              if (!found && !found2) {
                  _cmd.remove();
              }
          }
          if (_cmd.querySelector('.selectCmd') && _cmd.querySelector('.selectCmd').options.length == 2) {
              let selectCmd = _cmd.querySelector('.selectCmd');
              var option1text = selectCmd.options[0].innerText;
              var option1value = selectCmd.options[0].value;
              var option2text = selectCmd.options[1].innerText;
              var option2value = selectCmd.options[1].value;

              var select = '<div class="center selectCmd inputs tippied" data-logicalid="' + selectCmd.getAttribute("data-logicalId") + '" data-title="' + option1value + ' = ' + option1text + '</br>' + option2value + ' = ' + option2text+'">';
              select += '    <span>' + option1text + '</span>';
              select += '    <label class="binarySwitch tooltips">';
              select += '        <input type="checkbox" class="binarySwitch" data-checked="'+option1value+'" data-unchecked="'+option2value+'" >';
              select += '        <span class="binarySwitch execute">';
              select += '            <span class="binarySwitchHandle">';
              select += '            </span>';
              select += '        </span>';
              select += '    </label>';
              select += '    <span>' + option2text + '</span>';
              select += '</div>';

              selectCmd.parentNode.innerHTML = select;
              jeedom.cmd.addUpdateFunction(_cmd.getAttribute('data-cmd_id'), function(_options) {
                  console.log('cmd option',_options)
              });
          }
      });

      document.querySelector('.eqLogic[data-eqLogic_uid="#uid#"]').addEventListener('click', function(e) {
          if (_target = e.target.closest('.btn.execute')) {
              if (_target.getAttribute('data-logicalId') == 'WMStart') {
                  var payload = {};
                  document.querySelectorAll('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd.course').forEach(_cmd => {
                      payload[_cmd.getAttribute('data-logicalId')] = _cmd.value==''?'NOT_SELECTED':_cmd.value;
                  });
                  document.querySelectorAll('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd.options').forEach(_cmd => {
                      payload[_cmd.getAttribute('data-logicalId')] = _cmd.value;
                  });
                  document.querySelectorAll('.eqLogic[data-eqLogic_uid="#uid#"] .inputCmd.options').forEach(_cmd => {
                      payload[_cmd.getAttribute('data-logicalId')] = parseInt(_cmd.value);
                  });
                  document.querySelectorAll('.eqLogic[data-eqLogic_uid="#uid#"] .selectCmd.inputs').forEach(_cmd => {
                      var checkedValue = _cmd.querySelector('input.binarySwitch').getAttribute('data-checked');
                      var uncheckedValue = _cmd.querySelector('input.binarySwitch').getAttribute('data-unchecked');
                      payload[_cmd.getAttribute('data-logicalId')] = _cmd.querySelector('input.binarySwitch').checked?uncheckedValue:checkedValue;
                  });
                  jeedom.cmd.execute({ id: _target.getAttribute('data-cmd_id'), value: { course: payload }})
                  console.log(payload)
              } else {
                  jeedom.cmd.execute({ id: _target.getAttribute('data-cmd_id') })
              }
          }
      });

    </script>
</div>
